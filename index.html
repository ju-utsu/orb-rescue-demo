<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>FocusXR - Gaze Collection Game</title>
    <meta name="description" content="Futuristic WebXR game to boost focus and reflexes">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/supermedium/superframe@master/components/environment/dist/aframe-environment-component.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
        }
        
        #ui {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 999;
            color: #00ffff;
            font-size: 18px;
            text-shadow: 0 0 10px #00ffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            z-index: 999;
            color: #fff;
            text-align: center;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00ffff;
        }
        
        .glow {
            text-shadow: 0 0 10px currentColor;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div>
            <div class="glow">Score: <span id="score">0</span></div>
            <div class="glow">Level: <span id="level">1</span></div>
        </div>
        <div>
            <div class="glow">Focus: <span id="focus">100%</span></div>
            <div class="glow">Time: <span id="timer">60s</span></div>
        </div>
    </div>
    
    <div id="instructions">
        <h3 style="margin-top:0; color: #00ffff;">ðŸŽ¯ FocusXR Training</h3>
        <p>Look at the glowing orbs to collect them. Stay focused - missing targets reduces your focus meter!</p>
        <p><strong>VR/AR:</strong> Use your gaze cursor | <strong>Desktop:</strong> Move mouse to aim</p>
    </div>

    <a-scene 
        vr-mode-ui="enabled: true" 
        ar-mode-ui="enabled: true"
        background="color: #0f0f23"
        fog="type: exponential; density: 0.1; color: #0f0f23"
        cursor="rayOrigin: mouse; fuse: true; fuseTimeout: 1000"
        raycaster="objects: .collectible"
        embedded
        style="height: 100vh; width: 100vw;">
        
        <!-- Assets -->
        <a-assets>
            <a-mixin id="collectible" 
                geometry="primitive: sphere; radius: 0.3" 
                material="color: #00ffff; emissive: #004444; transparent: true; opacity: 0.8"
                animation__float="property: position; to: 0 0.5 0; dur: 2000; dir: alternate; loop: true; easing: easeInOutSine"
                animation__glow="property: components.material.material.emissiveIntensity; to: 0.8; dur: 1000; dir: alternate; loop: true"
                class="collectible">
            </a-mixin>
            
            <a-mixin id="particle-system"
                particle-system="preset: dust; particleCount: 100; color: #00ffff, #0066ff; size: 0.5">
            </a-mixin>
        </a-assets>

        <!-- Environment -->
        <a-entity environment="preset: tron; grid: 2x2; gridColor: #00ffff; groundColor: #0f0f23; skyType: atmosphere; skyColor: #0f0f23"></a-entity>
        
        <!-- Lighting -->
        <a-light type="ambient" color="#002244" intensity="0.3"></a-light>
        <a-light type="directional" position="5 10 5" color="#00ffff" intensity="0.5"></a-light>
        
        <!-- Camera with cursor -->
        <a-entity id="cameraRig" position="0 1.6 3">
            <a-camera 
                look-controls="pointerLockEnabled: false"
                wasd-controls="acceleration: 20"
                cursor="fuse: true; fuseTimeout: 1500">
                
                <!-- VR/AR Cursor -->
                <a-cursor 
                    position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
                    material="color: #00ffff; emissive: #00ffff; emissiveIntensity: 0.5"
                    animation__fuse="startEvents: fusing; property: scale; to: 1.5 1.5 1.5; dur: 1500"
                    animation__fusereverse="startEvents: mouseleave; property: scale; to: 1 1 1; dur: 100">
                </a-cursor>
            </a-camera>
        </a-entity>

        <!-- Game Objects Container -->
        <a-entity id="gameObjects"></a-entity>
        
        <!-- Particle Effects Container -->
        <a-entity id="particles"></a-entity>
        
        <!-- Sound Effects -->
        <a-entity id="sounds">
            <a-sound id="collectSound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhCSuEzvLWgC4kMIHL8ttwIBw9ibVnhKFhI3L5nD6RjQNZBsU7pKe1HBIgRUL8hBmGFxcQKZxKWxPqBIKHaA==" autoplay="false" loop="false" volume="0.5"></a-sound>
            <a-sound id="missSound" src="data:audio/wav;base64,UklGRp4CAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YXoCAAC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4" autoplay="false" loop="false" volume="0.3"></a-sound>
        </a-entity>
    </a-scene>

    <script>
        // Game State
        let gameState = {
            score: 0,
            level: 1,
            focus: 100,
            timeLeft: 60,
            gameActive: true,
            objectsCollected: 0,
            objectsMissed: 0,
            spawnRate: 3000, // ms between spawns
            objectLifetime: 8000, // how long objects stay alive
            maxObjects: 3
        };

        // Game Elements
        const scene = document.querySelector('a-scene');
        const gameObjects = document.querySelector('#gameObjects');
        const particles = document.querySelector('#particles');
        
        // UI Elements
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const focusEl = document.getElementById('focus');
        const timerEl = document.getElementById('timer');
        const instructionsEl = document.getElementById('instructions');

        // Initialize game when scene loads
        scene.addEventListener('loaded', initGame);

        function initGame() {
            console.log('Game initialized!');
            updateUI();
            startGameLoop();
            
            // Hide instructions after 5 seconds
            setTimeout(() => {
                instructionsEl.style.opacity = '0';
                setTimeout(() => {
                    instructionsEl.style.display = 'none';
                }, 1000);
            }, 5000);
        }

        function updateUI() {
            scoreEl.textContent = gameState.score;
            levelEl.textContent = gameState.level;
            focusEl.textContent = Math.max(0, gameState.focus) + '%';
            timerEl.textContent = gameState.timeLeft + 's';
            
            // Update focus color
            if (gameState.focus > 70) {
                focusEl.style.color = '#00ff00';
            } else if (gameState.focus > 30) {
                focusEl.style.color = '#ffff00';
            } else {
                focusEl.style.color = '#ff0000';
            }
        }

        function spawnCollectible() {
            if (!gameState.gameActive) return;
            
            const currentObjects = gameObjects.children.length;
            if (currentObjects >= gameState.maxObjects) return;

            const collectible = document.createElement('a-entity');
            collectible.setAttribute('mixin', 'collectible');
            
            // Random position around the player
            const angle = Math.random() * Math.PI * 2;
            const distance = 3 + Math.random() * 4;
            const height = 0.5 + Math.random() * 3;
            
            const x = Math.sin(angle) * distance;
            const z = Math.cos(angle) * distance;
            
            collectible.setAttribute('position', `${x} ${height} ${z}`);
            collectible.setAttribute('id', `collectible-${Date.now()}`);
            
            // Add click/gaze event
            collectible.addEventListener('click', handleCollect);
            collectible.addEventListener('fuse', handleCollect);
            
            gameObjects.appendChild(collectible);
            
            // Remove after lifetime expires
            setTimeout(() => {
                if (collectible.parentNode) {
                    handleMiss(collectible);
                }
            }, gameState.objectLifetime);
        }

        function handleCollect(event) {
            const collectible = event.target;
            
            // Update game state
            gameState.score += 10 * gameState.level;
            gameState.objectsCollected++;
            gameState.focus = Math.min(100, gameState.focus + 2);
            
            // Create collection effect
            createCollectionEffect(collectible.getAttribute('position'));
            
            // Play sound
            const sound = document.querySelector('#collectSound');
            sound.components.sound.playSound();
            
            // Remove object
            collectible.parentNode.removeChild(collectible);
            
            // Check for level up
            if (gameState.objectsCollected % 10 === 0) {
                levelUp();
            }
            
            updateUI();
        }

        function handleMiss(collectible) {
            if (!collectible.parentNode) return;
            
            // Update game state
            gameState.objectsMissed++;
            gameState.focus = Math.max(0, gameState.focus - 5);
            
            // Play miss sound
            const sound = document.querySelector('#missSound');
            sound.components.sound.playSound();
            
            // Remove object
            collectible.parentNode.removeChild(collectible);
            
            updateUI();
            
            // Check game over
            if (gameState.focus <= 0) {
                gameOver();
            }
        }

        function createCollectionEffect(position) {
            const effect = document.createElement('a-entity');
            effect.setAttribute('position', position);
            effect.setAttribute('particle-system', {
                preset: 'dust',
                particleCount: 50,
                color: '#00ffff, #ffffff',
                size: 0.1,
                accelerationValue: '0, 5, 0',
                velocityValue: '0, 2, 0',
                velocitySpread: '2, 1, 2'
            });
            
            particles.appendChild(effect);
            
            // Remove after animation
            setTimeout(() => {
                if (effect.parentNode) {
                    particles.removeChild(effect);
                }
            }, 2000);
        }

        function levelUp() {
            gameState.level++;
            gameState.spawnRate = Math.max(1000, gameState.spawnRate - 200);
            gameState.maxObjects = Math.min(5, gameState.maxObjects + 1);
            gameState.objectLifetime = Math.max(4000, gameState.objectLifetime - 500);
            
            // Show level up effect
            showMessage(`Level ${gameState.level}!`, '#00ff00');
        }

        function showMessage(text, color) {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: ${color};
                font-size: 48px;
                font-weight: bold;
                text-shadow: 0 0 20px ${color};
                z-index: 1000;
                animation: messageAnim 2s ease-out forwards;
            `;
            message.textContent = text;
            document.body.appendChild(message);
            
            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes messageAnim {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
                }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                document.body.removeChild(message);
                document.head.removeChild(style);
            }, 2000);
        }

        function gameOver() {
            gameState.gameActive = false;
            
            // Clear all objects
            while (gameObjects.firstChild) {
                gameObjects.removeChild(gameObjects.firstChild);
            }
            
            showMessage(`Game Over! Final Score: ${gameState.score}`, '#ff0000');
            
            // Show restart option
            setTimeout(() => {
                if (confirm(`Game Over!\n\nFinal Score: ${gameState.score}\nLevel Reached: ${gameState.level}\n\nRestart game?`)) {
                    restartGame();
                }
            }, 3000);
        }

        function restartGame() {
            // Reset game state
            gameState = {
                score: 0,
                level: 1,
                focus: 100,
                timeLeft: 60,
                gameActive: true,
                objectsCollected: 0,
                objectsMissed: 0,
                spawnRate: 3000,
                objectLifetime: 8000,
                maxObjects: 3
            };
            
            // Clear objects
            while (gameObjects.firstChild) {
                gameObjects.removeChild(gameObjects.firstChild);
            }
            
            updateUI();
            startGameLoop();
        }

        function startGameLoop() {
            if (!gameState.gameActive) return;
            
            // Spawn objects
            const spawnInterval = setInterval(() => {
                if (gameState.gameActive) {
                    spawnCollectible();
                } else {
                    clearInterval(spawnInterval);
                }
            }, gameState.spawnRate);
            
            // Game timer
            const timerInterval = setInterval(() => {
                if (gameState.gameActive) {
                    gameState.timeLeft--;
                    updateUI();
                    
                    if (gameState.timeLeft <= 0) {
                        clearInterval(timerInterval);
                        gameOver();
                    }
                } else {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        // Touch/click handling for mobile
        document.addEventListener('touchstart', function(e) {
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
    </html>

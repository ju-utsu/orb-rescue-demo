<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tomato VR â€” Neon Orb Collector</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: system-ui;
    background: #000;
    overflow: hidden;
  }
  #loader {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #00111a;
    z-index: 100;
    font-size: 2em;
    color: #0ff;
  }
  #menu {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #000010;
    border: 2px solid #0ff;
    padding: 20px;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 101;
    color: #0ff;
    font-weight: bold;
    text-align: center;
    min-width: 260px;
  }
  #menu input[type=number] {
    width: 60px;
    padding: 4px;
    background: #001a22;
    color: #0ff;
    border: 1px solid #0ff;
    border-radius: 4px;
    text-align: center;
  }
  #menu button {
    background: #001a22;
    color: #0ff;
    border: 1px solid #0ff;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  #hud {
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 102;
    font-size: 1.2em;
    color: #0ff;
    text-shadow: 0 0 8px #0ff;
  }
</style>
</head>
<body>

<div id="loader">Loading<span id="dots">...</span></div>

<div id="menu">
  <div>Adjust Settings Before Start</div>
  <label>Orb Gaze (sec):
    <input type="number" id="orbGazeInput" value="0.15" step="0.05" min="0.05" max="3">
  </label>
  <label>Danger Gaze (sec):
    <input type="number" id="dangerGazeInput" value="0.5" step="0.05" min="0.05" max="5">
  </label>
  <label>Orbs to Spawn:
    <input type="number" id="orbCountInput" value="10" min="1" max="30">
  </label>
  <label>Dangers to Spawn:
    <input type="number" id="dangerCountInput" value="5" min="1" max="20">
  </label>
  <button id="startBtn">Start Game</button>
</div>

<div id="hud">Score: <span id="scoreVal">0</span></div>

<a-scene background="color: #000011" embedded vr-mode-ui="enabled:true">

  <!-- Lights -->
  <a-entity light="type: ambient; intensity: 0.5"></a-entity>
  <a-entity light="type: directional; intensity: 1; position="1 4 1""></a-entity>

  <!-- Tron Grid -->
  <a-grid material="color: #0ff; opacity:0.15; shader: flat;" width="60" height="60" density="1"></a-grid>

  <!-- Player -->
  <a-entity id="rig" position="0 1.6 0">
    <a-entity camera look-controls>
      <a-entity cursor="fuse: true; fuseTimeout: 150"
                position="0 0 -0.03"
                geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.025"
                material="color: #0ff; shader: flat">
      </a-entity>
    </a-entity>
  </a-entity>

  <!-- Containers -->
  <a-entity id="collectSpawner"></a-entity>
  <a-entity id="dangerSpawner"></a-entity>

</a-scene>

<script>
  const loader = document.getElementById('loader');
  const menu = document.getElementById('menu');
  const startBtn = document.getElementById('startBtn');
  const scoreEl = document.getElementById('scoreVal');
  const collectSpawner = document.getElementById('collectSpawner');
  const dangerSpawner = document.getElementById('dangerSpawner');

  let state = {
    score: 0,
    running: false,
    orbGaze: parseFloat(document.getElementById('orbGazeInput').value),
    dangerGaze: parseFloat(document.getElementById('dangerGazeInput').value),
    orbCount: parseInt(document.getElementById('orbCountInput').value),
    dangerCount: parseInt(document.getElementById('dangerCountInput').value),
    timers: new Map(),
  };

  function setScore(v){
    state.score = v;
    scoreEl.textContent = v;
  }

  function randPos(){
    const r = 4 + Math.random()*10;
    const angle = Math.random()*Math.PI*2;
    const y = 0.8 + Math.random()*1.6;
    return {x: Math.cos(angle)*r, y, z: Math.sin(angle)*r};
  }

  function spawnCollect(){
    const pos = randPos();
    const orb = document.createElement('a-sphere');
    orb.classList.add('collect');
    orb.setAttribute('radius', 0.3);
    orb.setAttribute('color', '#0ff');
    orb.setAttribute('emissive', '#0ff');
    orb.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
    orb.setAttribute('animation', `property: position; dir: alternate; dur: 2000; to: ${pos.x} ${pos.y+0.3} ${pos.z}; loop: true; easing: easeInOutSine`);
    collectSpawner.appendChild(orb);

    orb.addEventListener('mouseenter', ()=>{
      if(!state.running) return;
      const to = setTimeout(()=>{
        orb.parentNode && orb.parentNode.removeChild(orb);
        setScore(state.score+1);
        spawnCollect();
      }, state.orbGaze*1000);
      state.timers.set(orb, to);
    });
    orb.addEventListener('mouseleave', ()=>{
      const to = state.timers.get(orb);
      if(to){ clearTimeout(to); state.timers.delete(orb);}
    });
  }

  function spawnDanger(){
    const pos = randPos();
    const danger = document.createElement('a-box');
    danger.classList.add('danger');
    danger.setAttribute('width', 0.5);
    danger.setAttribute('height', 0.5);
    danger.setAttribute('depth', 0.5);
    danger.setAttribute('color', '#f0f');
    danger.setAttribute('emissive', '#f0f');
    danger.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
    danger.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 4000; loop: true; easing: linear');
    dangerSpawner.appendChild(danger);

    danger.addEventListener('mouseenter', ()=>{
      if(!state.running) return;
      const to = setTimeout(()=>{
        alert("You gazed at a danger! Game Over.");
        window.location.reload();
      }, state.dangerGaze*1000);
      state.timers.set(danger, to);
    });
    danger.addEventListener('mouseleave', ()=>{
      const to = state.timers.get(danger);
      if(to){ clearTimeout(to); state.timers.delete(danger);}
    });
  }

  function startGame(){
    state.orbGaze = parseFloat(document.getElementById('orbGazeInput').value);
    state.dangerGaze = parseFloat(document.getElementById('dangerGazeInput').value);
    state.orbCount = parseInt(document.getElementById('orbCountInput').value);
    state.dangerCount = parseInt(document.getElementById('dangerCountInput').value);
    menu.style.display = 'none';
    setScore(0);
    state.running = true;

    for(let i=0;i<state.orbCount;i++) spawnCollect();
    for(let i=0;i<state.dangerCount;i++) spawnDanger();
  }

  startBtn.addEventListener('click', startGame);

  // Loader dots animation
  let dots = document.getElementById('dots');
  let dotCount = 0;
  const dotInterval = setInterval(()=>{
    dotCount = (dotCount+1)%4;
    dots.textContent = '.'.repeat(dotCount);
  }, 400);

  // Wait for scene to load
  const scene = document.querySelector('a-scene');
  scene.addEventListener('loaded', ()=>{
    loader.style.display = 'none';
    clearInterval(dotInterval);
  });
</script>
</body>
</html>

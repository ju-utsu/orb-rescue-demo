<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tron VR Orb Collector</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<style>
  body, html { margin: 0; height: 100%; background: #000; font-family: sans-serif; overflow: hidden; }
  #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #0ff; font-size: 2em; display: flex; gap: 0.3em; }
  .dot { width: 0.5em; height: 0.5em; border-radius: 50%; background: #0ff; animation: pulse 1s infinite; }
  .dot:nth-child(2){ animation-delay: 0.2s; }
  .dot:nth-child(3){ animation-delay: 0.4s; }
  @keyframes pulse { 0%,100%{ opacity: 0.2; } 50% { opacity: 1; } }

  #menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
          background: rgba(0,0,0,0.85); border: 2px solid #0ff; padding: 2em; border-radius: 12px;
          display: flex; flex-direction: column; gap: 1em; color: #0ff; text-align: center; }
  #menu label { display: flex; justify-content: space-between; font-size: 1.2em; }
  #menu input { width: 3em; text-align: center; background: #000; border: 1px solid #0ff; color: #0ff; }
  #menu button { padding: 0.5em 1em; font-size: 1.2em; background: #0ff; color: #000; border: none; border-radius: 6px; cursor: pointer; }
  #hud { position: absolute; top: 12px; left: 12px; color: #0ff; font-size: 1.2em; font-weight: bold; text-shadow: 0 0 8px #0ff; }
</style>
</head>
<body>

<div id="loader">
  <div class="dot"></div><div class="dot"></div><div class="dot"></div>
</div>

<div id="menu">
  <h2>TRON ORB COLLECTOR</h2>
  <label>Orb Gaze Time (sec) <input type="number" id="orbTime" value="0.15" step="0.05" min="0.05" max="3"></label>
  <label>Danger Gaze Time (sec) <input type="number" id="dangerTime" value="0.5" step="0.05" min="0.05" max="5"></label>
  <label>Number of Orbs <input type="number" id="numOrbs" value="8" step="1" min="1" max="30"></label>
  <label>Number of Dangers <input type="number" id="numDangers" value="4" step="1" min="1" max="15"></label>
  <button id="startBtn">START GAME</button>
</div>

<div id="hud">Score: <span id="scoreVal">0</span></div>

<a-scene id="scene" embedded vr-mode-ui="enabled: true" background="color: #01010f">
  <a-assets>
    <audio id="collectSound" src="https://cdn.aframe.io/basic-guide/audio/click.ogg"></audio>
    <audio id="dangerSound" src="https://cdn.aframe.io/basic-guide/audio/explosion.ogg"></audio>
  </a-assets>

  <!-- Neon ground grid -->
  <a-plane rotation="-90 0 0" width="40" height="40" color="#000" material="shader: flat" grid-helper="size:40; divisions:20; colorCenterLine: #0ff"></a-plane>

  <!-- Lighting -->
  <a-entity light="type: ambient; color: #0ff; intensity: 0.3"></a-entity>
  <a-entity light="type: directional; color: #0ff; intensity: 0.6" position="2 4 2"></a-entity>

  <!-- Player Camera -->
  <a-entity id="rig" position="0 1.6 0">
    <a-camera id="camera">
      <a-cursor fuse="true" fuse-timeout="150" material="color: #0ff; shader: flat" geometry="radiusInner:0.005; radiusOuter:0.015"></a-cursor>
    </a-camera>
  </a-entity>

  <!-- Containers -->
  <a-entity id="collectContainer"></a-entity>
  <a-entity id="dangerContainer"></a-entity>

</a-scene>

<script>
const loader = document.getElementById('loader');
const menu = document.getElementById('menu');
const startBtn = document.getElementById('startBtn');
const orbTimeInput = document.getElementById('orbTime');
const dangerTimeInput = document.getElementById('dangerTime');
const numOrbsInput = document.getElementById('numOrbs');
const numDangersInput = document.getElementById('numDangers');
const scoreVal = document.getElementById('scoreVal');

let state = { score:0, orbGaze:0.15, dangerGaze:0.5, numOrbs:8, numDangers:4, running:false, timers:new Map() };
let collectContainer, dangerContainer;

function updateScore(v){ state.score=v; scoreVal.textContent=v; }

function spawnOrb(){
  const p = randPos();
  const orb = document.createElement('a-sphere');
  orb.classList.add('collectable');
  orb.setAttribute('position', `${p.x} ${p.y} ${p.z}`);
  orb.setAttribute('radius', '0.3');
  orb.setAttribute('color', '#ff0');
  orb.setAttribute('emissive', '#ffeb99');
  orb.setAttribute('animation__float', `property: position; dir: alternate; dur: 2000; to: ${p.x} ${p.y+0.25} ${p.z}; loop: true; easing: easeInOutSine`);
  collectContainer.appendChild(orb);

  orb.addEventListener('click', ()=>collectOrb(orb));
}

function spawnDanger(){
  const p = randPos();
  const bad = document.createElement('a-box');
  bad.classList.add('danger');
  bad.setAttribute('position', `${p.x} ${p.y} ${p.z}`);
  bad.setAttribute('color', '#f00');
  bad.setAttribute('depth','0.5'); bad.setAttribute('height','0.5'); bad.setAttribute('width','0.5');
  dangerContainer.appendChild(bad);

  bad.addEventListener('click', ()=>gameOver('Gazed danger'));
}

function collectOrb(orb){
  orb.parentNode.removeChild(orb);
  document.getElementById('collectSound').play().catch(()=>{});
  updateScore(state.score+1);
  spawnOrb();
}

function randPos(){
  const r = 4 + Math.random()*8;
  const a = Math.random()*Math.PI*2;
  const y = 0.8 + Math.random()*1.5;
  return {x: Math.cos(a)*r, y, z: Math.sin(a)*r};
}

function gameOver(reason){
  alert('Game Over! '+reason);
  state.running=false;
  restartGame();
}

function restartGame(){
  // Clear containers
  collectContainer.innerHTML=''; dangerContainer.innerHTML='';
  updateScore(0);
  for(let i=0;i<state.numOrbs;i++) spawnOrb();
  for(let i=0;i<state.numDangers;i++) spawnDanger();
  state.running=true;
}

// Start game button
startBtn.addEventListener('click', ()=>{
  state.orbGaze = parseFloat(orbTimeInput.value);
  state.dangerGaze = parseFloat(dangerTimeInput.value);
  state.numOrbs = parseInt(numOrbsInput.value);
  state.numDangers = parseInt(numDangersInput.value);

  menu.style.display='none';
  loader.style.display='none';
  collectContainer = document.querySelector('#collectContainer');
  dangerContainer = document.querySelector('#dangerContainer');

  restartGame();
});

// Scene loaded hide loader
document.querySelector('a-scene').addEventListener('loaded', ()=>{
  loader.style.display='none';
});
</script>
  
</body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>VR Orb Collector Game</title>
    <meta name="description" content="VR Orb Collector Game">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/loaders/GLTFLoader.js"></script>
    <style>
      .hud-text {
        font-size: 80px;
        color: white;
        text-align: center;
        width: 100%;
      }
      #menu {
        display: none;
        position: absolute;
        top: 20%;
        left: 30%;
        width: 40%;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        font-size: 24px;
        z-index: 999;
      }
      button {
        font-size: 20px;
        margin-top: 20px;
        padding: 10px 20px;
      }
    </style>
  </head>
  <body>
    <div id="menu">
      <h2>Game Menu</h2>
      <p>Collect orbs, avoid danger objects!</p>
      <button id="closeMenu">Close Menu</button>
    </div>

    <a-scene background="color: black" cursor="rayOrigin: mouse" raycaster="objects: .clickable" vr-mode-ui="enabled: true">
      
      <!-- Camera with HUD -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <a-camera>
          <!-- Score Text -->
          <a-entity id="scoreText" text="value: Score: 0; color: #FFF; width: 2" position="0.7 0.6 -1"></a-entity>
          
          <!-- 3D Gear -->
          <a-entity id="gearContainer" position="0.7 0.3 -1" scale="0.2 0.2 0.2" class="clickable"></a-entity>
        </a-camera>
      </a-entity>

      <!-- Lighting -->
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 1" position="1 3 2"></a-entity>

      <!-- Ground -->
      <a-plane rotation="-90 0 0" width="30" height="30" color="#333"></a-plane>
    </a-scene>

    <script>
      let score = 0;
      const scoreText = document.getElementById("scoreText");
      const menu = document.getElementById("menu");
      const closeMenuBtn = document.getElementById("closeMenu");

      // Load GLTF Gear
      const gearContainer = document.getElementById("gearContainer");
      let gearModel;
      const loader = new THREE.GLTFLoader();
      loader.load("https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/GearboxAssy/glTF/GearboxAssy.gltf", function(gltf) {
        gearModel = gltf.scene;
        gearModel.rotation.y = Math.PI / 2;
        gearContainer.setObject3D("mesh", gearModel);
      });

      // Idle rotation + faster spin on gaze
      let isGazed = false;
      gearContainer.addEventListener("mouseenter", () => {
        isGazed = true;
      });
      gearContainer.addEventListener("mouseleave", () => {
        isGazed = false;
      });
      gearContainer.addEventListener("click", () => {
        menu.style.display = "block";
      });

      // Close menu
      closeMenuBtn.addEventListener("click", () => {
        menu.style.display = "none";
      });

      // Rotate gear smoothly
      function rotateGear() {
        if (gearModel) {
          gearModel.rotation.z += isGazed ? 0.05 : 0.01;
        }
        requestAnimationFrame(rotateGear);
      }
      rotateGear();

      // Spawn Orbs and Danger Objects
      function spawnObject(color, isDanger = false) {
        const scene = document.querySelector("a-scene");
        const entity = document.createElement("a-sphere");
        entity.setAttribute("radius", isDanger ? "0.5" : "0.3");
        entity.setAttribute("color", color);
        const x = (Math.random() - 0.5) * 10;
        const z = (Math.random() - 0.5) * 10;
        entity.setAttribute("position", `${x} 1.5 ${z}`);
        entity.classList.add("clickable");
        scene.appendChild(entity);

        if (!isDanger) {
          entity.addEventListener("click", () => {
            score += 10;
            scoreText.setAttribute("text", `value: Score: ${score}`);
            entity.parentNode.removeChild(entity);
          });
        } else {
          entity.addEventListener("click", () => {
            score -= 5;
            scoreText.setAttribute("text", `value: Score: ${score}`);
            entity.parentNode.removeChild(entity);
          });
        }
      }

      // Spawn multiple orbs and danger objects
      for (let i = 0; i < 30; i++) {
        spawnObject("#00FF00"); // Orbs
      }
      for (let i = 0; i < 15; i++) {
        spawnObject("#FF0000", true); // Danger objects
      }
    </script>
  </body>
</html>
